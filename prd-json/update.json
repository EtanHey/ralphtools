{
  "newStories": [
    {
      "id": "US-102",
      "title": "Refactor context architecture: extract interactive rules from base.md",
      "type": "feature",
      "priority": "high",
      "storyPoints": 3,
      "status": "pending",
      "acceptanceCriteria": [
        {"text": "Create ~/.claude/contexts/workflow/interactive.md", "checked": false},
        {"text": "Move git safety rules from base.md to interactive.md", "checked": false},
        {"text": "Move CLAUDE_COUNTER system from base.md to interactive.md", "checked": false},
        {"text": "Update base.md to only contain truly universal rules", "checked": false},
        {"text": "Remove OVERRIDE comment from ralph.md (no longer needed)", "checked": false},
        {"text": "Update README.md in contexts with new architecture", "checked": false},
        {"text": "Commit changes", "checked": false}
      ],
      "dependencies": []
    },
    {
      "id": "US-103",
      "title": "Update nextjs.md for Next.js 15+ async params pattern",
      "type": "feature",
      "priority": "medium",
      "storyPoints": 2,
      "status": "pending",
      "acceptanceCriteria": [
        {"text": "Update Provider Setup example to use Promise<{locale}> pattern", "checked": false},
        {"text": "Update any other params examples to async pattern", "checked": false},
        {"text": "Add note about Next.js 15+ requirement", "checked": false},
        {"text": "Commit changes", "checked": false}
      ],
      "dependencies": []
    },
    {
      "id": "BUG-021",
      "title": "Pre-commit hook missing Bun tests (83 tests not enforced)",
      "type": "bug",
      "priority": "high",
      "storyPoints": 2,
      "status": "pending",
      "acceptanceCriteria": [
        {"text": "Add Bun test section to .githooks/pre-commit", "checked": false},
        {"text": "Only run if bun/ directory exists", "checked": false},
        {"text": "Run: cd bun && bun test", "checked": false},
        {"text": "Fail commit if Bun tests fail", "checked": false},
        {"text": "Test: verify commit blocked when test fails", "checked": false},
        {"text": "Commit changes", "checked": false}
      ],
      "dependencies": []
    },
    {
      "id": "US-104",
      "title": "Clean up skill references in context files",
      "type": "feature",
      "priority": "medium",
      "storyPoints": 2,
      "status": "pending",
      "acceptanceCriteria": [
        {"text": "Update ralph.md to just reference /prd-manager skill", "checked": false},
        {"text": "Update convex.md to reference /convex skill for dev server", "checked": false},
        {"text": "Keep simple one-liner CLI commands", "checked": false},
        {"text": "Add note about checking package.json for project commands", "checked": false},
        {"text": "Commit changes", "checked": false}
      ],
      "dependencies": []
    },
    {
      "id": "BUG-022",
      "title": "Wire --ui-ink flag to actually use React Ink UI",
      "type": "bug",
      "priority": "high",
      "storyPoints": 3,
      "status": "completed",
      "passes": true,
      "acceptanceCriteria": [
        {"text": "Find where _ralph_show_iteration_status is called in main loop", "checked": true},
        {"text": "Add conditional: if use_ink_ui, call _ralph_show_ink_ui instead", "checked": true},
        {"text": "Pass correct parameters (mode, prd_path, iteration, model, start_time)", "checked": true},
        {"text": "Handle fallback gracefully if Ink UI fails", "checked": true},
        {"text": "Test: ralph 5 --ui-ink shows Ink dashboard instead of shell UI", "checked": true},
        {"text": "Test: ralph 5 (no flag) shows shell UI as before", "checked": true},
        {"text": "Commit changes", "checked": true}
      ],
      "dependencies": ["US-085"]
    },
    {
      "id": "US-105",
      "title": "Enhanced Ink UI: alive indicator, CodeRabbit status, error detection",
      "description": "## Implementation Approach\n\n### Status File Protocol\nralph.zsh writes status to /tmp/ralph-status-$$.json:\n```json\n{\"state\": \"running|cr_review|error|retry\", \"lastActivity\": 1234567890, \"error\": null, \"retryIn\": 0}\n```\n\n### Component Structure\n1. **AliveIndicator.tsx** - Spinner + 'last activity Xs ago' from lastActivity timestamp\n2. **CodeRabbitStatus.tsx** - Shows when state='cr_review', uses pgrep -f 'cr review'\n3. **ErrorBanner.tsx** - Red banner when state='error', shows error message\n4. **RetryCountdown.tsx** - Shows 'Retrying in Xs' when state='retry'\n5. **HangingWarning.tsx** - Yellow warning if Date.now() - lastActivity > 60000\n\n### ralph.zsh Changes\n- Write status file before/after cr review calls\n- Update lastActivity on each Claude output\n- Set error state when error detected\n- Set retry state during cooldown with retryIn countdown",
      "type": "feature",
      "priority": "medium",
      "storyPoints": 5,
      "status": "pending",
      "acceptanceCriteria": [
        {"text": "=== STATUS FILE PROTOCOL ===", "checked": false},
        {"text": "Create _ralph_write_status() helper in ralph.zsh", "checked": false},
        {"text": "Write status file at /tmp/ralph-status-$$.json", "checked": false},
        {"text": "Update lastActivity timestamp on Claude output received", "checked": false},
        {"text": "Set state='cr_review' before cr review call, state='running' after", "checked": false},
        {"text": "Set state='error' with error message when error detected", "checked": false},
        {"text": "Set state='retry' with retryIn seconds during cooldown", "checked": false},
        {"text": "Clean up status file in cleanup_ralph() trap", "checked": false},
        {"text": "=== REACT INK COMPONENTS ===", "checked": false},
        {"text": "Create components/AliveIndicator.tsx with spinner + last activity", "checked": false},
        {"text": "Create components/CodeRabbitStatus.tsx for CR review state", "checked": false},
        {"text": "Create components/ErrorBanner.tsx for error display", "checked": false},
        {"text": "Create components/RetryCountdown.tsx for retry state", "checked": false},
        {"text": "Create components/HangingWarning.tsx (>60s no activity)", "checked": false},
        {"text": "Add useStatusFile hook to watch /tmp/ralph-status-$$.json", "checked": false},
        {"text": "Integrate all components into Dashboard.tsx", "checked": false},
        {"text": "=== TESTING ===", "checked": false},
        {"text": "Test: Status file created on ralph start", "checked": false},
        {"text": "Test: lastActivity updates during execution", "checked": false},
        {"text": "Test: CodeRabbit status shows during cr review", "checked": false},
        {"text": "Test: Error banner shows on API error", "checked": false},
        {"text": "Test: Hanging warning shows after 60s inactivity", "checked": false},
        {"text": "Commit changes", "checked": false}
      ],
      "dependencies": ["BUG-022"]
    }
  ]
}
