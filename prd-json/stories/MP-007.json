{
  "id": "MP-007",
  "title": "Implement node-pty runner for ralph-ui",
  "description": "Major feature: Implement the node-pty architecture from docs.local/live-ui-research/. ralph-ui spawns Claude via node-pty, captures output with TTY semantics, displays in Ink UI. The 'working terminal hidden under reading terminal' pattern.",
  "acceptanceCriteria": [
    {"text": "=== PRE-REQ: Read Research & Audit ===", "checked": true},
    {"text": "Read docs.local/live-ui-research/round-3-agent-9-synthesis.md", "checked": true},
    {"text": "Read docs.local/audit-node-pty.md from AUDIT-003", "checked": true},
    {"text": "=== PHASE 1: PTY WRAPPER ===", "checked": true},
    {"text": "Install node-pty: bun add node-pty", "checked": true},
    {"text": "Create ralph-ui/src/runner/pty-wrapper.ts", "checked": true},
    {"text": "Implement PTYProcess interface per research spec", "checked": true},
    {"text": "Handle signal propagation (Ctrl+C â†’ graceful PTY termination)", "checked": true},
    {"text": "All TEST-005 pty-wrapper tests pass", "checked": true},
    {"text": "=== PHASE 2: DUAL OUTPUT PIPELINE ===", "checked": true},
    {"text": "Create ralph-ui/src/runner/dual-output.ts", "checked": true},
    {"text": "Display path: PassThrough stream (ANSI preserved)", "checked": true},
    {"text": "File path: strip-ansi transform for clean logs", "checked": true},
    {"text": "Log files: ~/.config/ralphtools/runs/{timestamp}/output.log", "checked": true},
    {"text": "All TEST-005 dual-output tests pass", "checked": true},
    {"text": "=== PHASE 3: EVENT SYSTEM ===", "checked": true},
    {"text": "Create ralph-ui/src/runner/events.ts", "checked": true},
    {"text": "Emit structured events: {type, timestamp, data, ansi, exitCode}", "checked": true},
    {"text": "All TEST-005 event tests pass", "checked": true},
    {"text": "=== PHASE 4: INK INTEGRATION ===", "checked": true},
    {"text": "Wire PTY output to Ink <Static> component", "checked": true},
    {"text": "Batch updates: 50 lines OR 100ms, whichever first", "checked": true},
    {"text": "Status bar shows current command, elapsed time", "checked": true},
    {"text": "Ctrl+C propagates to PTY for graceful termination", "checked": true},
    {"text": "=== PHASE 5: RALPH INTEGRATION ===", "checked": true},
    {"text": "ralph-ui --run spawns Claude via node-pty", "checked": true},
    {"text": "ralph command uses ralph-ui --run internally", "checked": true},
    {"text": "User sees: clean Ink UI with live Claude output", "checked": true},
    {"text": "=== ALL TESTS PASS ===", "checked": true},
    {"text": "bun test ralph-ui/tests/ - all pass", "checked": true},
    {"text": "Run CodeRabbit review - must pass (or create BUG if unfixable)", "checked": true},
    {"text": "Commit: feat: MP-007 implement node-pty runner for ralph-ui", "checked": true}
  ],
  "dependencies": ["TEST-005"],
  "passes": true,
  "completedAt": "2026-01-25T12:10:57.000Z",
  "completedBy": "opus"
}
