{
  "id": "TEST-004",
  "title": "Integration tests for existing ralph behavior",
  "description": "Write integration tests that capture current ralph.zsh behavior BEFORE refactoring. These tests will catch regressions during MP-006 migration.",
  "acceptanceCriteria": [
    {"text": "=== CHARACTERIZATION TESTS ===", "checked": true},
    {"text": "Test: ralph --help shows all flags", "checked": true},
    {"text": "Test: ralph 1 runs single iteration (mock Claude)", "checked": true},
    {"text": "Test: ralph reads prd-json/index.json correctly", "checked": true},
    {"text": "Test: ralph updates story criteria when checked", "checked": true},
    {"text": "Test: ralph moves completed story to completed array", "checked": true},
    {"text": "Test: ralph respects --gap flag for sleep", "checked": true},
    {"text": "Test: ralph --notify sends ntfy notification", "checked": true},
    {"text": "=== STATUS FILE TESTS ===", "checked": true},
    {"text": "Test: ralph writes ~/.ralph-status.json during run", "checked": true},
    {"text": "Test: status file contains iteration, story, model, lastActivity", "checked": true},
    {"text": "=== UPDATE.JSON TESTS ===", "checked": true},
    {"text": "Test: ralph processes update.json at iteration start", "checked": true},
    {"text": "Test: update.json newStories are added to pending", "checked": true},
    {"text": "=== TEST INFRASTRUCTURE ===", "checked": true},
    {"text": "Tests in tests/integration/ directory", "checked": true},
    {"text": "Mock Claude responses for predictable testing", "checked": true},
    {"text": "All tests pass: ./tests/integration/run.sh", "checked": true},
    {"text": "Run CodeRabbit review - must pass (or create BUG if unfixable)", "checked": true},
    {"text": "Commit: test: TEST-004 integration tests for existing ralph", "checked": false}
  ],
  "dependencies": ["AUDIT-002"],
  "passes": false
}
