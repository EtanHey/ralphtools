{
  "id": "AUDIT-128",
  "title": "Verify Session Context System",
  "description": "Audit story to verify MP-128 session context works end-to-end. Tests -QN flag flows correctly through the entire chain.",
  "acceptanceCriteria": [
    {
      "text": "Verify RALPH_SESSION is exported in ralph.zsh before bun spawn",
      "checked": true
    },
    {
      "text": "Verify detectRunner() returns 'ralph' during Ralph execution",
      "checked": true
    },
    {
      "text": "Test: Add unit test asserting ctx.notifications.enabled=true when RALPH_NOTIFY=1",
      "checked": true
    },
    {
      "text": "Test: Add unit test asserting ctx.notifications.enabled=false when RALPH_NOTIFY unset",
      "checked": true
    },
    {
      "text": "Verify notification topic flows from config → context → ntfy call",
      "checked": true
    },
    {
      "text": "Add verbose log: '[SESSION] runner={runner} model={model} notify={enabled}'",
      "checked": true
    },
    {
      "text": "Test: Add unit test for [SESSION] log output with expected values",
      "checked": true
    },
    {
      "text": "Run full test suite: bun test - all tests pass",
      "checked": true
    },
    {
      "text": "Typecheck passes",
      "checked": true
    },
    {
      "text": "Run CodeRabbit review - must pass (or create BUG if unfixable)",
      "checked": true
    },
    {
      "text": "Commit: test: AUDIT-128 verify session context system",
      "checked": false
    }
  ],
  "storyType": "audit",
  "blockedBy": null,
  "passes": false
}
