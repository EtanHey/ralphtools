{
  "id": "MP-129",
  "title": "Notify System for Agent-User Communication (TDD)",
  "description": "Add ntfy notification system so agents (Ralph/Claude) can reach the user when stuck, done, or need input. Topic auto-derived from project context. TDD approach.",
  "acceptanceCriteria": [
    {"text": "TDD: Write bun/tests/notify.test.ts FIRST with failing tests", "checked": false},
    {"text": "TDD: Test buildTopic() returns 'etanheys-ralph-{project}-notify' format", "checked": false},
    {"text": "TDD: Test sendNotification() builds correct curl args (topic, title, body, priority)", "checked": false},
    {"text": "TDD: Test priority validation (low, default, high, urgent)", "checked": false},
    {"text": "TDD: Test getProjectName() extracts basename from cwd", "checked": false},
    {"text": "IMPL: Create ralph-ui/src/runner/notify.ts with buildTopic, sendNotification", "checked": false},
    {"text": "IMPL: sendNotification logs '[NTFY] Sending to {topic}: {title}'", "checked": false},
    {"text": "IMPL: Handle curl errors gracefully, log '[NTFY] Failed: {reason}'", "checked": false},
    {"text": "DOCS: Add '## NOTIFY USER' section to ~/.claude/CLAUDE.md with curl examples", "checked": false},
    {"text": "DOCS: Include when to notify (stuck, done, error, need approval)", "checked": false},
    {"text": "All tests pass: bun test bun/tests/notify.test.ts", "checked": false},
    {"text": "Typecheck passes", "checked": false},
    {"text": "Run CodeRabbit review - must pass (or create BUG if unfixable)", "checked": false},
    {"text": "Commit: feat: MP-129 add notify system for agent-user communication", "checked": false}
  ],
  "storyType": "infrastructure",
  "blockedBy": "US-129",
  "notes": "Uses SessionContext from MP-128. Notify reads ctx.notifications.enabled and ctx.notifications.topic. WHY THIS WORKS: In a prior session, Claude naturally used `curl ntfy.sh/etanheys-ralph-claude-golem-notify` to notify the user after completing PRD work - simply because the pattern was discussed and 'top of mind'. This proves: if the notify pattern is visible in CLAUDE.md, agents will naturally use it when appropriate (done, stuck, need input).",
  "passes": false
}
