{
  "id": "US-106",
  "title": "UI Foundation: derived stats + status file protocol",
  "description": "Foundation for both Ink and Gum UIs. Two key pieces:\n\n1. DERIVED STATS: Remove inline stats from index.json. Create function that computes stats on-the-fly.\n\n2. STATUS FILE PROTOCOL: Ralph writes state to /tmp/ralph-status-$$.json for UIs to watch.\n\nStatus file format:\n```json\n{\"state\": \"running|cr_review|error|retry\", \"lastActivity\": 1234567890, \"error\": null, \"retryIn\": 0}\n```\n\nThis is the shared infrastructure that US-105 (Ink) and US-108 (Gum) both depend on.",
  "type": "feature",
  "priority": "high",
  "storyPoints": 5,
  "status": "pending",
  "acceptanceCriteria": [
    {"text": "=== DERIVED STATS ===", "checked": true},
    {"text": "Remove stats object from index.json", "checked": true},
    {"text": "Create _ralph_derive_stats() function in ralph.zsh", "checked": true},
    {"text": "Function counts: pending array, blocked array, stories/*.json with passes:true", "checked": true},
    {"text": "Ralph startup uses _ralph_derive_stats() for display", "checked": true},
    {"text": "ralph-status command uses same function", "checked": true},
    {"text": "=== STATUS FILE PROTOCOL ===", "checked": true},
    {"text": "Create _ralph_write_status() helper in ralph.zsh", "checked": true},
    {"text": "Write status file at /tmp/ralph-status-$$.json", "checked": true},
    {"text": "Update lastActivity timestamp on Claude output received", "checked": true},
    {"text": "Set state='running' during normal execution", "checked": true},
    {"text": "Set state='cr_review' before CodeRabbit call", "checked": true},
    {"text": "Set state='error' with error message on failure", "checked": true},
    {"text": "Set state='retry' with retryIn seconds during cooldown", "checked": true},
    {"text": "Clean up status file in cleanup_ralph() trap", "checked": true},
    {"text": "=== CHECK-PROGRESS WORKFLOW ===", "checked": true},
    {"text": "Add check-progress workflow to prd-manager skill", "checked": true},
    {"text": "Shows: nextStory, current story progress, derived stats, current state", "checked": true},
    {"text": "=== TESTING ===", "checked": false},
    {"text": "Test: ralph-status displays correct derived stats", "checked": false},
    {"text": "Test: Stats match actual story file states", "checked": false},
    {"text": "Test: Status file created on ralph start", "checked": false},
    {"text": "Test: Status file updates on state changes", "checked": false},
    {"text": "Test: Status file cleaned up on exit", "checked": false},
    {"text": "Run CodeRabbit review", "checked": false},
    {"text": "Commit: feat: US-106 UI foundation - derived stats and status file protocol", "checked": false}
  ],
  "dependencies": [],
  "passes": false
}
