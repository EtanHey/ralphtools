{
  "id": "MP-128",
  "title": "Session Context Manager (TDD)",
  "description": "Unified session context system to manage runner type, model, and notifications. Replaces scattered env/flag/config checks with single source of truth. TDD approach - tests first.",
  "acceptanceCriteria": [
    {"text": "TDD: Write tests/session-context.test.ts FIRST with failing tests", "checked": false},
    {"text": "TDD: Test SessionContext.create() returns valid context object", "checked": false},
    {"text": "TDD: Test detectRunner() returns 'ralph' when RALPH_SESSION set", "checked": false},
    {"text": "TDD: Test detectRunner() returns 'direct' when no RALPH_SESSION", "checked": false},
    {"text": "TDD: Test resolveNotifyConfig() merges env + config + flags correctly", "checked": false},
    {"text": "TDD: Test ctx.notifications.enabled reflects -QN flag", "checked": false},
    {"text": "IMPL: Create ralph-ui/src/runner/session-context.ts", "checked": false},
    {"text": "IMPL: SessionContext interface with runner, model, interactive, notifications", "checked": false},
    {"text": "IMPL: SessionContext.create() factory function", "checked": false},
    {"text": "IMPL: detectRunner() checks RALPH_SESSION env", "checked": false},
    {"text": "IMPL: resolveNotifyConfig() unifies notification config resolution", "checked": false},
    {"text": "IMPL: Export RALPH_SESSION=sessionId from ralph.zsh before spawning", "checked": false},
    {"text": "INTEGRATE: Update ralph-ui/src/runner/index.ts to use SessionContext", "checked": false},
    {"text": "INTEGRATE: Replace scattered notify checks with ctx.notifications.enabled", "checked": false},
    {"text": "All tests pass: bun test bun/tests/session-context.test.ts", "checked": false},
    {"text": "Typecheck passes", "checked": false},
    {"text": "Run CodeRabbit review - must pass (or create BUG if unfixable)", "checked": false},
    {"text": "Commit: refactor: MP-128 add unified session context manager", "checked": false}
  ],
  "storyType": "infrastructure",
  "passes": false
}
