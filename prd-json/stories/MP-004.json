{
  "id": "MP-004",
  "title": "Split ralph.zsh into modular files",
  "description": "Split the 9600+ line ralph.zsh into logical modules for maintainability.\n\nTarget structure:\n- ralph.zsh (~500 lines) - Core loop, sources modules\n- lib/ralph-ui.zsh - Colors, progress bars, display\n- lib/ralph-watcher.zsh - Live updates, orphan tracking\n- lib/ralph-commands.zsh - Helper commands (ralph-logs, ralph-session, etc.)\n- lib/ralph-models.zsh - Model routing, MCP setup\n- lib/ralph-registry.zsh - Projects, launchers, repoGolem\n- lib/ralph-worktrees.zsh - Git worktree isolation\n- lib/ralph-secrets.zsh - 1Password integration\n- lib/ralph-setup.zsh - Wizard, first-run\n\nAll modules go in ~/.config/ralphtools/lib/ and are sourced by main ralph.zsh.",
  "acceptanceCriteria": [
    {"text": "Create ~/.config/ralphtools/lib/ directory structure", "checked": true},
    {"text": "Extract UI helpers (colors, progress bars) to lib/ralph-ui.zsh", "checked": true},
    {"text": "Extract watcher/orphan tracking to lib/ralph-watcher.zsh", "checked": true},
    {"text": "Extract helper commands to lib/ralph-commands.zsh", "checked": true},
    {"text": "Extract model routing/MCP to lib/ralph-models.zsh", "checked": false},
    {"text": "Extract registry/launchers to lib/ralph-registry.zsh", "checked": false},
    {"text": "Extract worktree functions to lib/ralph-worktrees.zsh", "checked": false},
    {"text": "Extract secrets/1Password to lib/ralph-secrets.zsh", "checked": false},
    {"text": "Extract setup wizard to lib/ralph-setup.zsh", "checked": false},
    {"text": "Main ralph.zsh sources all lib/*.zsh files", "checked": true},
    {"text": "Add test: verify all lib files are sourced and functions exist", "checked": true},
    {"text": "Add test: verify ralph --help still works after split", "checked": true},
    {"text": "Add test: verify ralph-status, ralph-session, ralph-logs work", "checked": true},
    {"text": "Run ./tests/test-ralph.zsh - all 122+ tests pass", "checked": true},
    {"text": "Run CodeRabbit review - must pass (or create BUG if unfixable)", "checked": false},
    {"text": "Commit: refactor: MP-004 split ralph.zsh into modular files", "checked": false}
  ],
  "storyType": "MP",
  "priority": "high",
  "createdAt": "2026-01-25T00:10:00Z"
}
