{
  "id": "TEST-005",
  "title": "Integration tests for node-pty runner",
  "description": "Write tests BEFORE implementing MP-007. Mock node-pty, test dual-output streams, test event emission. These tests catch regressions during implementation.",
  "acceptanceCriteria": [
    {"text": "=== PRE-REQ ===", "checked": true},
    {"text": "Read docs.local/audit-node-pty.md from AUDIT-003", "checked": true},
    {"text": "=== PTY WRAPPER TESTS ===", "checked": true},
    {"text": "Test: pty-wrapper spawns process correctly (mock)", "checked": true},
    {"text": "Test: onData callback receives output chunks", "checked": true},
    {"text": "Test: onExit callback receives exit code", "checked": true},
    {"text": "Test: kill() terminates process", "checked": true},
    {"text": "Test: resize() updates terminal dimensions", "checked": true},
    {"text": "=== DUAL OUTPUT TESTS ===", "checked": true},
    {"text": "Test: display stream preserves ANSI codes", "checked": true},
    {"text": "Test: file stream strips ANSI codes", "checked": true},
    {"text": "Test: both streams receive same content", "checked": true},
    {"text": "=== EVENT EMITTER TESTS ===", "checked": true},
    {"text": "Test: events have correct format (type, timestamp, data)", "checked": true},
    {"text": "Test: data events include ansi flag", "checked": true},
    {"text": "Test: exit events include exitCode", "checked": true},
    {"text": "=== SIGNAL HANDLING TESTS ===", "checked": true},
    {"text": "Test: SIGINT propagates to child process", "checked": true},
    {"text": "Test: graceful shutdown closes all streams", "checked": true},
    {"text": "=== INFRASTRUCTURE ===", "checked": true},
    {"text": "Tests in ralph-ui/tests/runner/", "checked": true},
    {"text": "Mock node-pty for predictable testing", "checked": true},
    {"text": "All tests pass: bun test ralph-ui/tests/runner/", "checked": true},
    {"text": "Run CodeRabbit review - must pass (or create BUG if unfixable)", "checked": true},
    {"text": "Commit: test: TEST-005 integration tests for node-pty runner", "checked": true}
  ],
  "dependencies": ["AUDIT-003"],
  "passes": true,
  "completedAt": "2026-01-25T11:55:00.000Z",
  "completedBy": "opus"
}
