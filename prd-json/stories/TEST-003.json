{
  "id": "TEST-003",
  "title": "Comprehensive update.json merge tests",
  "description": "Add tests for the update.json hot-reload merge functionality. Given the bugs encountered (jq parse errors, empty strings in arrays, corrupt index.json state), we need comprehensive test coverage.\n\nReference: _ralph_apply_update_queue() in ralph.zsh lines 3002-3090",
  "type": "test",
  "priority": "high",
  "storyPoints": 5,
  "status": "pending",
  "acceptanceCriteria": [
    {"text": "=== NEW STORY TESTS ===", "checked": true},
    {"text": "Test: newStories creates story file in stories/ dir", "checked": true},
    {"text": "Test: newStories adds story ID to pending array (no duplicates)", "checked": true},
    {"text": "Test: newStories adds story ID to storyOrder array (no duplicates)", "checked": true},
    {"text": "Test: Multiple newStories in one update.json all processed", "checked": true},
    {"text": "=== UPDATE STORY TESTS ===", "checked": true},
    {"text": "Test: updateStories merges changes into existing story file", "checked": true},
    {"text": "Test: updateStories preserves unmodified fields", "checked": true},
    {"text": "Test: updateStories skips non-existent story IDs gracefully", "checked": true},
    {"text": "=== STATS RECALCULATION TESTS ===", "checked": true},
    {"text": "Test: Stats total count updated after newStories", "checked": true},
    {"text": "Test: Stats pending count matches pending array length", "checked": true},
    {"text": "Test: Stats blocked count preserved", "checked": true},
    {"text": "=== ERROR HANDLING TESTS ===", "checked": true},
    {"text": "Test: Malformed JSON in update.json handled gracefully", "checked": true},
    {"text": "Test: Empty update.json (no newStories/updateStories) is a no-op", "checked": true},
    {"text": "Test: Missing index.json returns error code 1", "checked": true},
    {"text": "=== CLEANUP TESTS ===", "checked": true},
    {"text": "Test: update.json deleted after successful merge", "checked": true},
    {"text": "Test: update.json preserved if merge fails", "checked": true},
    {"text": "=== IGNORED FIELDS WARNING ===", "checked": true},
    {"text": "Test: Warning printed for ignored fields (storyOrder, pending, stats)", "checked": true},
    {"text": "=== INTEGRATION ===", "checked": true},
    {"text": "All tests added to tests/test-ralph.zsh", "checked": true},
    {"text": "Test count increased (currently 59 tests)", "checked": true},
    {"text": "Run CodeRabbit review - must pass (or create BUG if unfixable)", "checked": true},
    {"text": "Commit: test: TEST-003 comprehensive update.json merge tests", "checked": true}
  ],
  "dependencies": [],
  "passes": true
}
