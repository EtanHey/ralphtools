{
  "id": "BUG-019",
  "title": "Configurable error handling and reliable retry logic",
  "description": "Make error handling configurable via config.json and fix the bug where Node.js unhandled promise rejections bypass shell pipe capture. Currently retries are hardcoded and 'No messages returned' errors sometimes print to terminal but aren't caught by the retry logic.",
  "type": "bug",
  "priority": "high",
  "storyPoints": 3,
  "status": "pending",
  "acceptanceCriteria": [
    {"text": "Add errorHandling section to config.json schema", "checked": true},
    {"text": "  - errorHandling.maxRetries (default: 5)", "checked": true},
    {"text": "  - errorHandling.noMessagesMaxRetries (default: 3)", "checked": true},
    {"text": "  - errorHandling.generalCooldownSeconds (default: 15)", "checked": true},
    {"text": "  - errorHandling.noMessagesCooldownSeconds (default: 30)", "checked": true},
    {"text": "Update ralph-setup wizard to include error handling config", "checked": true},
    {"text": "Load error handling settings from config.json in ralph.zsh", "checked": true},
    {"text": "FIX: Capture Node.js unhandled promise rejections properly", "checked": true},
    {"text": "  - Use script(1) or unbuffer to capture all terminal output", "checked": false},
    {"text": "  - OR: Wrap claude-code call with node --unhandled-rejections=strict", "checked": true},
    {"text": "  - OR: Pipe stderr separately and merge after", "checked": true},
    {"text": "Add error pattern: 'This error originated' (Node.js rejection preamble)", "checked": true},
    {"text": "Add error pattern: 'promise rejected with the reason'", "checked": true},
    {"text": "Test: Simulate 'No messages returned' - verify retry triggers", "checked": true},
    {"text": "Test: Verify config.json settings are respected", "checked": true},
    {"text": "Document error handling config in README", "checked": true}
  ],
  "dependencies": [],
  "passes": true,
  "completedAt": "2026-01-24T12:15:00Z",
  "completedBy": "opus"
}
