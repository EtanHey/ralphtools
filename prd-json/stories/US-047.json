{
  "$schema": "https://ralph.dev/schemas/story.schema.json",
  "id": "US-047",
  "title": "Script-backed Convex skill (deterministic execution)",
  "description": "The current Convex skill only has markdown workflows - Claude reads bash code blocks and tries to construct commands, leading to errors (e.g., combining 'sleep' with 'echo'). Following the pattern from docs/skill-creation-guide.md and the 1password skill: scripts execute WITHOUT loading code into context, only OUTPUT enters conversation. Agent invokes script, gets clean result. No interpretation, no construction, no errors.",
  "acceptanceCriteria": [
    {
      "text": "Research: Read docs/skill-creation-guide.md lines 209-272 (Scripts: Deterministic Execution)",
      "checked": true
    },
    {
      "text": "Research: Study skills/1password/scripts/migrate-env.sh as reference implementation",
      "checked": true
    },
    {
      "text": "Create scripts/clean-start.sh: rm -f convex/*.js && npx convex dev (handles errors, pretty output)",
      "checked": true
    },
    {
      "text": "Create scripts/deploy.sh: clean + deploy with optional 1Password key retrieval",
      "checked": true
    },
    {
      "text": "Create scripts/run-function.sh: validate args, execute query/mutation/action, format output",
      "checked": true
    },
    {
      "text": "Create scripts/export-data.sh: backup with timestamped filename, verify success",
      "checked": true
    },
    {
      "text": "Create scripts/import-data.sh: safety prompts, backup-first warning, execute import",
      "checked": true
    },
    {
      "text": "All scripts: set -e, explicit error handling, colored output, usage help (-h flag)",
      "checked": true
    },
    {
      "text": "All scripts: return structured output (SUCCESS/ERROR prefix) for agent parsing",
      "checked": true
    },
    {
      "text": "Update SKILL.md: Add 'Available Scripts' section with usage table (like 1password skill)",
      "checked": true
    },
    {
      "text": "Update workflows/*.md: Change 'Run: <code block>' to 'Run script: bash scripts/X.sh'",
      "checked": true
    },
    {
      "text": "Workflows become routing docs, not execution instructions",
      "checked": true
    },
    {
      "text": "Test: Agent can complete full dev-server-start with just script invocation",
      "checked": true
    },
    {
      "text": "Test: Agent gets clean output, never sees script source code in context",
      "checked": true
    },
    {
      "text": "Typecheck passes (bash -n on all scripts)",
      "checked": true
    }
  ],
  "passes": true,
  "blockedBy": null
}
